<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authenticating...</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="background-pattern"></div>
    <div class="container">
        <div class="auth-loading">
            <div class="loading-animation">
                <div class="spinner">
                    <div class="spinner-ring"></div>
                    <div class="spinner-ring"></div>
                    <div class="spinner-ring"></div>
                </div>
            </div>
            <h2>Authenticating...</h2>
            <p>Please wait while we securely log you in</p>
            <div class="progress-bar">
                <div class="progress-fill"></div>
            </div>
        </div>
    </div>

    <script>
        const MAIN_APP_URL = 'http://localhost:3000/auth/callback';

        function redirectToMainApp(accessToken, refreshToken) {
            if (!accessToken || !refreshToken) {
                window.location.href = `/?error=true&message=Authentication_failed._Please_try_again.`;
                return;
            }
            const redirectUrl = new URL(MAIN_APP_URL);
            redirectUrl.searchParams.set('access_token', accessToken);
            redirectUrl.searchParams.set('refresh_token', refreshToken);

            setTimeout(() => {
                window.location.href = redirectUrl.toString();
            }, 2000);
        }

        const urlParams = new URLSearchParams(window.location.search);
        const accessToken = urlParams.get('access_token');
        const refreshToken = urlParams.get('refresh_token');
        
        redirectToMainApp(accessToken, refreshToken);

        window.addEventListener('DOMContentLoaded', () => {
            const progressFill = document.querySelector('.progress-fill');
            progressFill.style.width = '100%';
        });
    </script>
</body>
</html>